

<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบจัดการทีม SRRT กรุงเทพมหานคร</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f0f4f8;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .slide-down {
            animation: slideDown 0.3s ease-in-out;
        }
        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Login Page -->
    <div id="loginPage" class="flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-500 to-purple-600">
        <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md fade-in">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">ระบบจัดการทีม SRRT</h1>
                <p class="text-gray-600 mt-2">กรุงเทพมหานคร</p>
            </div>
            <div class="mb-6">
                <label for="username" class="block text-gray-700 text-sm font-medium mb-2">ชื่อผู้ใช้</label>
                <input type="text" id="username" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="mb-6">
                <label for="password" class="block text-gray-700 text-sm font-medium mb-2">รหัสผ่าน</label>
                <input type="password" id="password" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <button id="loginBtn" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-300">เข้าสู่ระบบ</button>
            <div id="loginError" class="mt-4 text-red-500 text-center hidden"></div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="appContainer" class="hidden">
        <!-- Navigation -->
        <nav class="bg-blue-600 text-white shadow-md">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <h1 class="text-xl font-bold">ระบบจัดการทีม SRRT กรุงเทพมหานคร</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="allStaffBtn" class="px-3 py-1 rounded hover:bg-blue-700 transition">รายชื่อทั้งหมด</button>
                    <button id="verifiedStaffBtn" class="px-3 py-1 rounded hover:bg-blue-700 transition admin-only hidden">รายชื่อที่ยืนยันแล้ว</button>
                    <button id="accountManagementBtn" class="px-3 py-1 rounded hover:bg-blue-700 transition admin-only hidden">จัดการบัญชีผู้ใช้</button>
                    <div class="border-l border-blue-400 h-6 mx-2"></div>
                    <span id="currentUser" class="text-sm"></span>
                    <button id="logoutBtn" class="px-3 py-1 bg-red-500 rounded hover:bg-red-600 transition">ออกจากระบบ</button>
                </div>
            </div>
        </nav>

        <!-- All Staff Page -->
        <div id="allStaffPage" class="container mx-auto px-4 py-6">
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">รายชื่อเจ้าหน้าที่ทีม SRRT ทั้งหมด</h2>
                    <button id="addStaffBtn" class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 transition flex items-center">
                        <i class="fas fa-plus mr-2"></i> เพิ่มเจ้าหน้าที่
                    </button>
                </div>

                <div class="mb-6 flex flex-wrap gap-4">
                    <div class="w-full md:w-1/3">
                        <label class="block text-gray-700 text-sm font-medium mb-2">ค้นหาจากศูนย์บริการสาธารณสุข</label>
                        <select id="searchCenter" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">ทั้งหมด</option>
                        </select>
                    </div>
                    <div class="w-full md:w-1/3">
                        <label class="block text-gray-700 text-sm font-medium mb-2">ค้นหาจากชื่อ-นามสกุล</label>
                        <input type="text" id="searchName" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="พิมพ์ชื่อหรือนามสกุลที่ต้องการค้นหา">
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white">
                        <thead>
                            <tr class="bg-gray-100 text-gray-700">
                                <th class="py-3 px-4 text-left">ศูนย์ฯ</th>
                                <th class="py-3 px-4 text-left">คำนำหน้า</th>
                                <th class="py-3 px-4 text-left">ชื่อ</th>
                                <th class="py-3 px-4 text-left">นามสกุล</th>
                                <th class="py-3 px-4 text-left">ตำแหน่ง</th>
                                <th class="py-3 px-4 text-left">เบอร์โทรศัพท์</th>
                                <th class="py-3 px-4 text-left">อีเมล</th>
                                <th class="py-3 px-4 text-center">การดำเนินการ</th>
                            </tr>
                        </thead>
                        <tbody id="staffTableBody">
                            <!-- Staff data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Verified Staff Page -->
        <div id="verifiedStaffPage" class="container mx-auto px-4 py-6 hidden">
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">รายชื่อเจ้าหน้าที่ที่ยืนยันแล้ว</h2>
                    <button id="exportExcelBtn" class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 transition flex items-center">
                        <i class="fas fa-file-excel mr-2"></i> ส่งออก Excel
                    </button>
                </div>

                <div class="mb-6 flex flex-wrap gap-4">
                    <div class="w-full md:w-1/3">
                        <label class="block text-gray-700 text-sm font-medium mb-2">ค้นหาจากศูนย์บริการสาธารณสุข</label>
                        <select id="searchCenterVerified" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">ทั้งหมด</option>
                        </select>
                    </div>
                    <div class="w-full md:w-1/3">
                        <label class="block text-gray-700 text-sm font-medium mb-2">ค้นหาจากชื่อ-นามสกุล</label>
                        <input type="text" id="searchNameVerified" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="พิมพ์ชื่อหรือนามสกุลที่ต้องการค้นหา">
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white">
                        <thead>
                            <tr class="bg-gray-100 text-gray-700">
                                <th class="py-3 px-4 text-left">ศูนย์ฯ</th>
                                <th class="py-3 px-4 text-left">คำนำหน้า</th>
                                <th class="py-3 px-4 text-left">ชื่อ</th>
                                <th class="py-3 px-4 text-left">นามสกุล</th>
                                <th class="py-3 px-4 text-left">ตำแหน่ง</th>
                                <th class="py-3 px-4 text-left">เบอร์โทรศัพท์</th>
                                <th class="py-3 px-4 text-left">อีเมล</th>
                                <th class="py-3 px-4 text-center">การดำเนินการ</th>
                            </tr>
                        </thead>
                        <tbody id="verifiedStaffTableBody">
                            <!-- Verified staff data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Account Management Page -->
        <div id="accountManagementPage" class="container mx-auto px-4 py-6 hidden">
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">จัดการบัญชีผู้ใช้</h2>
                    <button id="addAccountBtn" class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 transition flex items-center">
                        <i class="fas fa-plus mr-2"></i> เพิ่มบัญชีผู้ใช้
                    </button>
                </div>

                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white">
                        <thead>
                            <tr class="bg-gray-100 text-gray-700">
                                <th class="py-3 px-4 text-left">ชื่อผู้ใช้</th>
                                <th class="py-3 px-4 text-left">ประเภทผู้ใช้</th>
                                <th class="py-3 px-4 text-center">การดำเนินการ</th>
                            </tr>
                        </thead>
                        <tbody id="accountTableBody">
                            <!-- Account data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Staff Modal -->
    <div id="addStaffModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-2xl slide-down">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">เพิ่มเจ้าหน้าที่ใหม่</h3>
                <button class="closeModal text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addStaffForm" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2">ศูนย์บริการสาธารณสุข</label>
                        <select id="newStaffCenter" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <option value="">เลือกศูนย์บริการสาธารณสุข</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2">คำนำหน้าชื่อ</label>
                        <select id="newStaffPrefix" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <option value="">เลือกคำนำหน้าชื่อ</option>
                            <option value="นาย">นาย</option>
                            <option value="นาง">นาง</option>
                            <option value="นางสาว">นางสาว</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2">ชื่อ</label>
                        <input type="text" id="newStaffFirstName" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2">นามสกุล</label>
                        <input type="text" id="newStaffLastName" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                </div>
                <div>
                    <label class="block text-gray-700 text-sm font-medium mb-2">ตำแหน่ง</label>
                    <input type="text" id="newStaffPosition" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2">เบอร์โทรศัพท์</label>
                        <input type="tel" id="newStaffPhone" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2">อีเมล</label>
                        <input type="email" id="newStaffEmail" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" class="closeModal px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-100 transition">ยกเลิก</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition">บันทึก</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Staff Modal -->
    <div id="editStaffModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-2xl slide-down">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">แก้ไขข้อมูลเจ้าหน้าที่</h3>
                <button class="closeModal text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="editStaffForm" class="space-y-4">
                <input type="hidden" id="editStaffId">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2">ศูนย์บริการสาธารณสุข</label>
                        <select id="editStaffCenter" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <option value="">เลือกศูนย์บริการสาธารณสุข</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2">คำนำหน้าชื่อ</label>
                        <select id="editStaffPrefix" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <option value="">เลือกคำนำหน้าชื่อ</option>
                            <option value="นาย">นาย</option>
                            <option value="นาง">นาง</option>
                            <option value="นางสาว">นางสาว</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2">ชื่อ</label>
                        <input type="text" id="editStaffFirstName" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2">นามสกุล</label>
                        <input type="text" id="editStaffLastName" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                </div>
                <div>
                    <label class="block text-gray-700 text-sm font-medium mb-2">ตำแหน่ง</label>
                    <input type="text" id="editStaffPosition" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2">เบอร์โทรศัพท์</label>
                        <input type="tel" id="editStaffPhone" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2">อีเมล</label>
                        <input type="email" id="editStaffEmail" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" class="closeModal px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-100 transition">ยกเลิก</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition">บันทึก</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Account Modal -->
    <div id="addAccountModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-md slide-down">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">เพิ่มบัญชีผู้ใช้</h3>
                <button class="closeModal text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addAccountForm" class="space-y-4">
                <div>
                    <label class="block text-gray-700 text-sm font-medium mb-2">ชื่อผู้ใช้</label>
                    <input type="text" id="newAccountUsername" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div>
                    <label class="block text-gray-700 text-sm font-medium mb-2">รหัสผ่าน</label>
                    <input type="password" id="newAccountPassword" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div>
                    <label class="block text-gray-700 text-sm font-medium mb-2">ประเภทผู้ใช้</label>
                    <select id="newAccountType" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        <option value="">เลือกประเภทผู้ใช้</option>
                        <option value="admin">ผู้ดูแลระบบ</option>
                        <option value="user">ผู้ใช้ทั่วไป</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" class="closeModal px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-100 transition">ยกเลิก</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition">บันทึก</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Account Modal -->
    <div id="editAccountModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-md slide-down">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">แก้ไขบัญชีผู้ใช้</h3>
                <button class="closeModal text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="editAccountForm" class="space-y-4">
                <input type="hidden" id="editAccountUsername">
                <div>
                    <label class="block text-gray-700 text-sm font-medium mb-2">ชื่อผู้ใช้</label>
                    <input type="text" id="displayEditUsername" class="w-full px-4 py-2 border border-gray-300 rounded-md bg-gray-100" disabled>
                </div>
                <div>
                    <label class="block text-gray-700 text-sm font-medium mb-2">รหัสผ่านใหม่ (เว้นว่างถ้าไม่ต้องการเปลี่ยน)</label>
                    <input type="password" id="editAccountPassword" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-gray-700 text-sm font-medium mb-2">ประเภทผู้ใช้</label>
                    <select id="editAccountType" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        <option value="">เลือกประเภทผู้ใช้</option>
                        <option value="admin">ผู้ดูแลระบบ</option>
                        <option value="user">ผู้ใช้ทั่วไป</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" class="closeModal px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-100 transition">ยกเลิก</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition">บันทึก</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-md slide-down">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">ยืนยันการดำเนินการ</h3>
                <button class="closeModal text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <p id="confirmationMessage" class="text-gray-700 mb-6"></p>
            <div class="flex justify-end space-x-3">
                <button id="cancelConfirmation" class="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-100 transition">ยกเลิก</button>
                <button id="confirmAction" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition">ยืนยัน</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 right-4 bg-gray-800 text-white px-6 py-3 rounded-md shadow-lg z-50 hidden">
        <span id="toastMessage"></span>
    </div>

    <script>
        // Initialize data
        function initializeData() {
            // Initialize users if not exists
            if (!localStorage.getItem('users')) {
                const defaultUsers = [
                    { username: 'bmasrrt', password: 'bmasrrt', type: 'admin' }
                ];
                localStorage.setItem('users', JSON.stringify(defaultUsers));
            }

            // Initialize staff if not exists
            if (!localStorage.getItem('staff')) {
                const sampleStaff = [
                    {
                        id: 1,
                        center: '1',
                        prefix: 'นาย',
                        firstName: 'สมชาย',
                        lastName: 'ใจดี',
                        position: 'พยาบาลวิชาชีพ',
                        phone: '0812345678',
                        email: 'somchai@bma.go.th',
                        verified: false
                    },
                    {
                        id: 2,
                        center: '2',
                        prefix: 'นางสาว',
                        firstName: 'สมหญิง',
                        lastName: 'รักดี',
                        position: 'นักวิชาการสาธารณสุข',
                        phone: '0898765432',
                        email: 'somying@bma.go.th',
                        verified: false
                    },
                    {
                        id: 3,
                        center: '3',
                        prefix: 'นาง',
                        firstName: 'วิมล',
                        lastName: 'สุขสันต์',
                        position: 'แพทย์',
                        phone: '0823456789',
                        email: 'wimon@bma.go.th',
                        verified: false
                    }
                ];
                localStorage.setItem('staff', JSON.stringify(sampleStaff));
            }
        }

        // DOM Elements
        const loginPage = document.getElementById('loginPage');
        const appContainer = document.getElementById('appContainer');
        const allStaffPage = document.getElementById('allStaffPage');
        const verifiedStaffPage = document.getElementById('verifiedStaffPage');
        const accountManagementPage = document.getElementById('accountManagementPage');
        const staffTableBody = document.getElementById('staffTableBody');
        const verifiedStaffTableBody = document.getElementById('verifiedStaffTableBody');
        const accountTableBody = document.getElementById('accountTableBody');
        const currentUser = document.getElementById('currentUser');
        const adminOnlyElements = document.querySelectorAll('.admin-only');

        // Initialize health centers
        function initializeHealthCenters() {
            const centers = [];
            for (let i = 1; i <= 69; i++) {
                centers.push({ id: i.toString(), name: `ศูนย์บริการสาธารณสุข ${i}` });
            }
            return centers;
        }

        const healthCenters = initializeHealthCenters();

        // Populate health center dropdowns
        function populateHealthCenterDropdowns() {
            const centerDropdowns = [
                document.getElementById('searchCenter'),
                document.getElementById('searchCenterVerified'),
                document.getElementById('newStaffCenter'),
                document.getElementById('editStaffCenter')
            ];

            centerDropdowns.forEach(dropdown => {
                if (!dropdown) return;
                
                // Clear existing options except the first one
                while (dropdown.options.length > 1) {
                    dropdown.remove(1);
                }

                // Add health centers
                healthCenters.forEach(center => {
                    const option = document.createElement('option');
                    option.value = center.id;
                    option.textContent = center.name;
                    dropdown.appendChild(option);
                });
            });
        }

        // Login functionality
        document.getElementById('loginBtn').addEventListener('click', function() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const users = JSON.parse(localStorage.getItem('users'));
            
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                // Store current user in session
                sessionStorage.setItem('currentUser', JSON.stringify(user));
                
                // Show/hide admin features
                if (user.type === 'admin') {
                    adminOnlyElements.forEach(el => el.classList.remove('hidden'));
                } else {
                    adminOnlyElements.forEach(el => el.classList.add('hidden'));
                }
                
                // Display username
                currentUser.textContent = `${username} (${user.type === 'admin' ? 'ผู้ดูแลระบบ' : 'ผู้ใช้ทั่วไป'})`;
                
                // Hide login page and show app
                loginPage.classList.add('hidden');
                appContainer.classList.remove('hidden');
                
                // Load staff data
                loadStaffData();
                
                // Show toast
                showToast('เข้าสู่ระบบสำเร็จ');
            } else {
                document.getElementById('loginError').textContent = 'ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง';
                document.getElementById('loginError').classList.remove('hidden');
            }
        });

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', function() {
            sessionStorage.removeItem('currentUser');
            appContainer.classList.add('hidden');
            loginPage.classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('loginError').classList.add('hidden');
        });

        // Navigation
        document.getElementById('allStaffBtn').addEventListener('click', function() {
            allStaffPage.classList.remove('hidden');
            verifiedStaffPage.classList.add('hidden');
            accountManagementPage.classList.add('hidden');
            loadStaffData();
        });

        document.getElementById('verifiedStaffBtn').addEventListener('click', function() {
            allStaffPage.classList.add('hidden');
            verifiedStaffPage.classList.remove('hidden');
            accountManagementPage.classList.add('hidden');
            loadVerifiedStaffData();
        });

        document.getElementById('accountManagementBtn').addEventListener('click', function() {
            allStaffPage.classList.add('hidden');
            verifiedStaffPage.classList.add('hidden');
            accountManagementPage.classList.remove('hidden');
            loadAccountData();
        });

        // Load staff data
        function loadStaffData() {
            const staff = JSON.parse(localStorage.getItem('staff')) || [];
            const searchCenter = document.getElementById('searchCenter').value;
            const searchName = document.getElementById('searchName').value.toLowerCase();
            
            // Sort by center number
            staff.sort((a, b) => {
                return parseInt(a.center) - parseInt(b.center);
            });
            
            // Filter staff
            const filteredStaff = staff.filter(s => {
                const centerMatch = !searchCenter || s.center === searchCenter;
                const nameMatch = !searchName || 
                    s.firstName.toLowerCase().includes(searchName) || 
                    s.lastName.toLowerCase().includes(searchName);
                return centerMatch && nameMatch;
            });
            
            // Clear table
            staffTableBody.innerHTML = '';
            
            // Add staff to table
            filteredStaff.forEach(s => {
                const row = document.createElement('tr');
                row.className = s.verified ? 'bg-green-100' : '';
                row.innerHTML = `
                    <td class="py-3 px-4">${s.center}</td>
                    <td class="py-3 px-4">${s.prefix}</td>
                    <td class="py-3 px-4">${s.firstName}</td>
                    <td class="py-3 px-4">${s.lastName}</td>
                    <td class="py-3 px-4">${s.position}</td>
                    <td class="py-3 px-4">${s.phone}</td>
                    <td class="py-3 px-4">${s.email}</td>
                    <td class="py-3 px-4 text-center">
                        ${s.verified ? 
                            `<span class="text-green-600 font-medium">ยืนยันแล้ว</span>` : 
                            `<div class="flex justify-center space-x-2">
                                <button class="verify-staff bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 transition" data-id="${s.id}">
                                    <i class="fas fa-check"></i> ถูกต้อง
                                </button>
                                <button class="edit-staff bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 transition" data-id="${s.id}">
                                    <i class="fas fa-edit"></i> แก้ไข
                                </button>
                                <button class="delete-staff bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 transition" data-id="${s.id}">
                                    <i class="fas fa-trash"></i> ลบ
                                </button>
                            </div>`
                        }
                    </td>
                `;
                staffTableBody.appendChild(row);
            });
            
            // Add event listeners
            addStaffEventListeners();
        }

        // Load verified staff data
        function loadVerifiedStaffData() {
            const staff = JSON.parse(localStorage.getItem('staff')) || [];
            const searchCenter = document.getElementById('searchCenterVerified').value;
            const searchName = document.getElementById('searchNameVerified').value.toLowerCase();
            
            // Sort by center number
            staff.sort((a, b) => {
                return parseInt(a.center) - parseInt(b.center);
            });
            
            // Filter verified staff
            const filteredStaff = staff.filter(s => {
                const centerMatch = !searchCenter || s.center === searchCenter;
                const nameMatch = !searchName || 
                    s.firstName.toLowerCase().includes(searchName) || 
                    s.lastName.toLowerCase().includes(searchName);
                return s.verified && centerMatch && nameMatch;
            });
            
            // Clear table
            verifiedStaffTableBody.innerHTML = '';
            
            // Add staff to table
            filteredStaff.forEach(s => {
                const row = document.createElement('tr');
                row.className = 'bg-green-100';
                row.innerHTML = `
                    <td class="py-3 px-4">${s.center}</td>
                    <td class="py-3 px-4">${s.prefix}</td>
                    <td class="py-3 px-4">${s.firstName}</td>
                    <td class="py-3 px-4">${s.lastName}</td>
                    <td class="py-3 px-4">${s.position}</td>
                    <td class="py-3 px-4">${s.phone}</td>
                    <td class="py-3 px-4">${s.email}</td>
                    <td class="py-3 px-4 text-center">
                        <button class="cancel-verify bg-yellow-500 text-white px-2 py-1 rounded hover:bg-yellow-600 transition" data-id="${s.id}">
                            <i class="fas fa-times"></i> ยกเลิกการยืนยัน
                        </button>
                    </td>
                `;
                verifiedStaffTableBody.appendChild(row);
            });
            
            // Add event listeners
            addVerifiedStaffEventListeners();
        }

        // Load account data
        function loadAccountData() {
            const users = JSON.parse(localStorage.getItem('users')) || [];
            
            // Clear table
            accountTableBody.innerHTML = '';
            
            // Add users to table
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="py-3 px-4">${user.username}</td>
                    <td class="py-3 px-4">${user.type === 'admin' ? 'ผู้ดูแลระบบ' : 'ผู้ใช้ทั่วไป'}</td>
                    <td class="py-3 px-4 text-center">
                        <div class="flex justify-center space-x-2">
                            <button class="edit-account bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 transition" data-username="${user.username}">
                                <i class="fas fa-edit"></i> แก้ไข
                            </button>
                            <button class="delete-account bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 transition" data-username="${user.username}">
                                <i class="fas fa-trash"></i> ลบ
                            </button>
                        </div>
                    </td>
                `;
                accountTableBody.appendChild(row);
            });
            
            // Add event listeners
            addAccountEventListeners();
        }

        // Add staff event listeners
        function addStaffEventListeners() {
            // Verify staff
            document.querySelectorAll('.verify-staff').forEach(button => {
                button.addEventListener('click', function() {
                    const staffId = parseInt(this.getAttribute('data-id'));
                    const staff = JSON.parse(localStorage.getItem('staff')) || [];
                    const staffIndex = staff.findIndex(s => s.id === staffId);
                    
                    if (staffIndex !== -1) {
                        staff[staffIndex].verified = true;
                        localStorage.setItem('staff', JSON.stringify(staff));
                        loadStaffData();
                        showToast('ยืนยันข้อมูลเจ้าหน้าที่สำเร็จ');
                    }
                });
            });
            
            // Edit staff
            document.querySelectorAll('.edit-staff').forEach(button => {
                button.addEventListener('click', function() {
                    const staffId = parseInt(this.getAttribute('data-id'));
                    const staff = JSON.parse(localStorage.getItem('staff')) || [];
                    const staffMember = staff.find(s => s.id === staffId);
                    
                    if (staffMember) {
                        document.getElementById('editStaffId').value = staffMember.id;
                        document.getElementById('editStaffCenter').value = staffMember.center;
                        document.getElementById('editStaffPrefix').value = staffMember.prefix;
                        document.getElementById('editStaffFirstName').value = staffMember.firstName;
                        document.getElementById('editStaffLastName').value = staffMember.lastName;
                        document.getElementById('editStaffPosition').value = staffMember.position;
                        document.getElementById('editStaffPhone').value = staffMember.phone;
                        document.getElementById('editStaffEmail').value = staffMember.email;
                        
                        document.getElementById('editStaffModal').classList.remove('hidden');
                    }
                });
            });
            
            // Delete staff
            document.querySelectorAll('.delete-staff').forEach(button => {
                button.addEventListener('click', function() {
                    const staffId = parseInt(this.getAttribute('data-id'));
                    const staff = JSON.parse(localStorage.getItem('staff')) || [];
                    const staffMember = staff.find(s => s.id === staffId);
                    
                    if (staffMember) {
                        document.getElementById('confirmationMessage').textContent = `คุณต้องการลบ ${staffMember.prefix}${staffMember.firstName} ${staffMember.lastName} ใช่หรือไม่?`;
                        document.getElementById('confirmationModal').classList.remove('hidden');
                        
                        document.getElementById('confirmAction').onclick = function() {
                            const updatedStaff = staff.filter(s => s.id !== staffId);
                            localStorage.setItem('staff', JSON.stringify(updatedStaff));
                            document.getElementById('confirmationModal').classList.add('hidden');
                            loadStaffData();
                            showToast('ลบข้อมูลเจ้าหน้าที่สำเร็จ');
                        };
                    }
                });
            });
        }

        // Add verified staff event listeners
        function addVerifiedStaffEventListeners() {
            // Cancel verification
            document.querySelectorAll('.cancel-verify').forEach(button => {
                button.addEventListener('click', function() {
                    const staffId = parseInt(this.getAttribute('data-id'));
                    const staff = JSON.parse(localStorage.getItem('staff')) || [];
                    const staffIndex = staff.findIndex(s => s.id === staffId);
                    
                    if (staffIndex !== -1) {
                        staff[staffIndex].verified = false;
                        localStorage.setItem('staff', JSON.stringify(staff));
                        loadVerifiedStaffData();
                        showToast('ยกเลิกการยืนยันข้อมูลเจ้าหน้าที่สำเร็จ');
                    }
                });
            });
        }

        // Add account event listeners
        function addAccountEventListeners() {
            // Edit account
            document.querySelectorAll('.edit-account').forEach(button => {
                button.addEventListener('click', function() {
                    const username = this.getAttribute('data-username');
                    const users = JSON.parse(localStorage.getItem('users')) || [];
                    const user = users.find(u => u.username === username);
                    
                    if (user) {
                        document.getElementById('editAccountUsername').value = user.username;
                        document.getElementById('displayEditUsername').value = user.username;
                        document.getElementById('editAccountPassword').value = '';
                        document.getElementById('editAccountType').value = user.type;
                        
                        document.getElementById('editAccountModal').classList.remove('hidden');
                    }
                });
            });
            
            // Delete account
            document.querySelectorAll('.delete-account').forEach(button => {
                button.addEventListener('click', function() {
                    const username = this.getAttribute('data-username');
                    const currentUserObj = JSON.parse(sessionStorage.getItem('currentUser'));
                    
                    // Prevent deleting own account
                    if (username === currentUserObj.username) {
                        showToast('ไม่สามารถลบบัญชีที่กำลังใช้งานอยู่ได้', 'error');
                        return;
                    }
                    
                    document.getElementById('confirmationMessage').textContent = `คุณต้องการลบบัญชีผู้ใช้ ${username} ใช่หรือไม่?`;
                    document.getElementById('confirmationModal').classList.remove('hidden');
                    
                    document.getElementById('confirmAction').onclick = function() {
                        const users = JSON.parse(localStorage.getItem('users')) || [];
                        const updatedUsers = users.filter(u => u.username !== username);
                        localStorage.setItem('users', JSON.stringify(updatedUsers));
                        document.getElementById('confirmationModal').classList.add('hidden');
                        loadAccountData();
                        showToast('ลบบัญชีผู้ใช้สำเร็จ');
                    };
                });
            });
        }

        // Add staff form submission
        document.getElementById('addStaffForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const staff = JSON.parse(localStorage.getItem('staff')) || [];
            const newId = staff.length > 0 ? Math.max(...staff.map(s => s.id)) + 1 : 1;
            
            const newStaff = {
                id: newId,
                center: document.getElementById('newStaffCenter').value,
                prefix: document.getElementById('newStaffPrefix').value,
                firstName: document.getElementById('newStaffFirstName').value,
                lastName: document.getElementById('newStaffLastName').value,
                position: document.getElementById('newStaffPosition').value,
                phone: document.getElementById('newStaffPhone').value,
                email: document.getElementById('newStaffEmail').value,
                verified: false
            };
            
            staff.push(newStaff);
            localStorage.setItem('staff', JSON.stringify(staff));
            
            document.getElementById('addStaffModal').classList.add('hidden');
            document.getElementById('addStaffForm').reset();
            loadStaffData();
            showToast('เพิ่มข้อมูลเจ้าหน้าที่สำเร็จ');
        });

        // Edit staff form submission
        document.getElementById('editStaffForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const staffId = parseInt(document.getElementById('editStaffId').value);
            const staff = JSON.parse(localStorage.getItem('staff')) || [];
            const staffIndex = staff.findIndex(s => s.id === staffId);
            
            if (staffIndex !== -1) {
                staff[staffIndex] = {
                    id: staffId,
                    center: document.getElementById('editStaffCenter').value,
                    prefix: document.getElementById('editStaffPrefix').value,
                    firstName: document.getElementById('editStaffFirstName').value,
                    lastName: document.getElementById('editStaffLastName').value,
                    position: document.getElementById('editStaffPosition').value,
                    phone: document.getElementById('editStaffPhone').value,
                    email: document.getElementById('editStaffEmail').value,
                    verified: staff[staffIndex].verified
                };
                
                localStorage.setItem('staff', JSON.stringify(staff));
                
                document.getElementById('editStaffModal').classList.add('hidden');
                loadStaffData();
                showToast('แก้ไขข้อมูลเจ้าหน้าที่สำเร็จ');
            }
        });

        // Add account form submission
        document.getElementById('addAccountForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('newAccountUsername').value;
            const password = document.getElementById('newAccountPassword').value;
            const type = document.getElementById('newAccountType').value;
            
            const users = JSON.parse(localStorage.getItem('users')) || [];
            
            // Check if username already exists
            if (users.some(u => u.username === username)) {
                showToast('ชื่อผู้ใช้นี้มีอยู่ในระบบแล้ว', 'error');
                return;
            }
            
            users.push({ username, password, type });
            localStorage.setItem('users', JSON.stringify(users));
            
            document.getElementById('addAccountModal').classList.add('hidden');
            document.getElementById('addAccountForm').reset();
            loadAccountData();
            showToast('เพิ่มบัญชีผู้ใช้สำเร็จ');
        });

        // Edit account form submission
        document.getElementById('editAccountForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('editAccountUsername').value;
            const password = document.getElementById('editAccountPassword').value;
            const type = document.getElementById('editAccountType').value;
            
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const userIndex = users.findIndex(u => u.username === username);
            
            if (userIndex !== -1) {
                // Update password only if provided
                if (password) {
                    users[userIndex].password = password;
                }
                
                users[userIndex].type = type;
                localStorage.setItem('users', JSON.stringify(users));
                
                // Update current user session if editing own account
                const currentUserObj = JSON.parse(sessionStorage.getItem('currentUser'));
                if (currentUserObj.username === username) {
                    currentUserObj.type = type;
                    sessionStorage.setItem('currentUser', JSON.stringify(currentUserObj));
                    
                    // Update UI based on new user type
                    if (type === 'admin') {
                        adminOnlyElements.forEach(el => el.classList.remove('hidden'));
                    } else {
                        adminOnlyElements.forEach(el => el.classList.add('hidden'));
                    }
                    
                    currentUser.textContent = `${username} (${type === 'admin' ? 'ผู้ดูแลระบบ' : 'ผู้ใช้ทั่วไป'})`;
                }
                
                document.getElementById('editAccountModal').classList.add('hidden');
                loadAccountData();
                showToast('แก้ไขบัญชีผู้ใช้สำเร็จ');
            }
        });

        // Show add staff modal
        document.getElementById('addStaffBtn').addEventListener('click', function() {
            document.getElementById('addStaffForm').reset();
            document.getElementById('addStaffModal').classList.remove('hidden');
        });

        // Show add account modal
        document.getElementById('addAccountBtn').addEventListener('click', function() {
            document.getElementById('addAccountForm').reset();
            document.getElementById('addAccountModal').classList.remove('hidden');
        });

        // Close modals
        document.querySelectorAll('.closeModal').forEach(button => {
            button.addEventListener('click', function() {
                document.getElementById('addStaffModal').classList.add('hidden');
                document.getElementById('editStaffModal').classList.add('hidden');
                document.getElementById('addAccountModal').classList.add('hidden');
                document.getElementById('editAccountModal').classList.add('hidden');
                document.getElementById('confirmationModal').classList.add('hidden');
            });
        });

        document.getElementById('cancelConfirmation').addEventListener('click', function() {
            document.getElementById('confirmationModal').classList.add('hidden');
        });

        // Search functionality
        document.getElementById('searchCenter').addEventListener('change', loadStaffData);
        document.getElementById('searchName').addEventListener('input', loadStaffData);
        document.getElementById('searchCenterVerified').addEventListener('change', loadVerifiedStaffData);
        document.getElementById('searchNameVerified').addEventListener('input', loadVerifiedStaffData);

        // Export to Excel
        document.getElementById('exportExcelBtn').addEventListener('click', function() {
            const staff = JSON.parse(localStorage.getItem('staff')) || [];
            const verifiedStaff = staff.filter(s => s.verified);
            
            // Sort by center number
            verifiedStaff.sort((a, b) => {
                return parseInt(a.center) - parseInt(b.center);
            });
            
            // Create worksheet
            const ws = XLSX.utils.json_to_sheet(verifiedStaff.map(s => ({
                'ศูนย์บริการสาธารณสุข': s.center,
                'คำนำหน้า': s.prefix,
                'ชื่อ': s.firstName,
                'นามสกุล': s.lastName,
                'ตำแหน่ง': s.position,
                'เบอร์โทรศัพท์': s.phone,
                'อีเมล': s.email
            })));
            
            // Create workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'รายชื่อเจ้าหน้าที่ SRRT');
            
            // Generate file and trigger download
            XLSX.writeFile(wb, 'รายชื่อเจ้าหน้าที่_SRRT_กทม.xlsx');
        });

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toast.className = 'fixed bottom-4 right-4 px-6 py-3 rounded-md shadow-lg z-50 fade-in';
            
            if (type === 'success') {
                toast.classList.add('bg-green-600', 'text-white');
            } else if (type === 'error') {
                toast.classList.add('bg-red-600', 'text-white');
            } else {
                toast.classList.add('bg-gray-800', 'text-white');
            }
            
            toastMessage.textContent = message;
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            initializeData();
            populateHealthCenterDropdowns();
            
            // Check if user is already logged in
            const currentUserObj = JSON.parse(sessionStorage.getItem('currentUser'));
            if (currentUserObj) {
                // Show/hide admin features
                if (currentUserObj.type === 'admin') {
                    adminOnlyElements.forEach(el => el.classList.remove('hidden'));
                } else {
                    adminOnlyElements.forEach(el => el.classList.add('hidden'));
                }
                
                // Display username
                currentUser.textContent = `${currentUserObj.username} (${currentUserObj.type === 'admin' ? 'ผู้ดูแลระบบ' : 'ผู้ใช้ทั่วไป'})`;
                
                // Hide login page and show app
                loginPage.classList.add('hidden');
                appContainer.classList.remove('hidden');
                
                // Load staff data
                loadStaffData();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'94c539f800b35d38',t:'MTc0OTM1MjU0NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
